#!/usr/bin/bash 
#Autor: Eduardo Lopez Solis 1865221

green="\e[0;32m\033[1m"
endColor="\033[0m\e[0m"
red="\e[0;31m\033[1m"
blue="\e[0;34m\033[1m"
listado=$(yum list installed | grep '^clamav')
version=$(grep 'VERSION_ID' /etc/os-release)

#1. Script will identify the version of the operating system and EPEL will be installed only on Centos v7 servers 

echo '******************************PROCEEDING TO IDENTIFY THE VERSION OF OS**********************************'
if [[ $version = 'VERSION_ID="8"' ]];
then
  echo -e "${blue}*********************************************************************************************************${endColor}"
  echo -e "${blue}*************************************YOUR OS IS CentOS v8************************************************${endColor}"
  echo -e "${blue}*********************************************************************************************************${endColor}"
  echo -e "${blue}*********************************************************************************************************${endColor}"
  echo -e "${blue}************************EPEL WILL NOT BE INSTALLED DUE TO THE CENTOS VERSION*****************************${endColor}"
  echo -e "${blue}*********************************************************************************************************${endColor}"
  
  #2. Clamav antivirus will be installed or reinstalled if it is already installed 
  
  if [[ $listado = "" ]];
  then
    echo -e "${red}*********************************************************************************************************${endColor}"
    echo -e "${red}**********************************CLAMAV IS NOT INSTALLED************************************************${endColor}"
    echo -e "${red}***********************************PROCEEDING TO INSTALL*************************************************${endColor}"
    echo -e "${red}*********************************************************************************************************${endColor}"
    sleep 3
    sudo yum -y install https://www.clamav.net/downloads/production/clamav-0.104.1.linux.x86_64.rpm
    echo -e "${final}*********************************************************************************************************${endColor}"
    echo -e "${final}***************************************SUCCESSFULLY INSTALLED********************************************${endColor}"
    echo -e "${final}*********************************************************************************************************${endColor}"
    sleep 3
  else
    echo -e "${blue}*********************************************************************************************************${endColor}"
    echo -e "${blue}**************************CLAMAV IS ALREADY INSTALLED, PROCEEDING TO UNINSTALL***************************${endColor}"
    echo -e "${blue}*********************************************************************************************************${endColor}"
    sleep 3
    sudo yum -y erase clamav*
    echo -e "${green}*********************************************************************************************************${endColor}"
    echo -e "${green}*************************************PROCEEDING TO INSTALL***********************************************${endColor}"
    echo -e "${green}*********************************************************************************************************${endColor}"
    sleep 3
    sudo yum -y install https://www.clamav.net/downloads/production/clamav-0.104.1.linux.x86_64.rpm
    echo -e "${final}*********************************************************************************************************${endColor}"
    echo -e "${final}***************************************SUCCESSFULLY INSTALLED********************************************${endColor}"
    echo -e "${final}*********************************************************************************************************${endColor}"
    sleep 3
  fi
elif [[ $version = 'VERSION_ID="7"' ]];
then
  echo -e "${blue}*********************************************************************************************************${endColor}"
  echo -e "${blue}*************************************YOUR OS IS CentOS v7************************************************${endColor}"
  echo -e "${blue}*********************************************************************************************************${endColor}"
  echo ''
  echo -e "${green}*********************************************************************************************************${endColor}"
  echo -e "${green}****************************CENTOS v7 DETECTED, EPEL WILL BE INSTALLED***********************************${endColor}"
  echo -e "${green}*********************************************************************************************************${endColor}"
  sleep 3
  sudo yum -y install https://dl.fedoraproject.org/pub/epel/epel-release-latest-7.noarch.rpm
  sleep 3
  if [[ $listado = "" ]];
  then
    echo -e "${red}*********************************************************************************************************${endColor}"
    echo -e "${red}**********************************CLAMAV IS NOT INSTALLED************************************************${endColor}"
    echo -e "${red}***********************************PROCEEDING TO INSTALL*************************************************${endColor}"
    echo -e "${red}*********************************************************************************************************${endColor}"
    sleep 3
    sudo yum -y install clamav
    echo -e "${final}*********************************************************************************************************${endColor}"
    echo -e "${final}***************************************SUCCESSFULLY INSTALLED********************************************${endColor}"
    echo -e "${final}*********************************************************************************************************${endColor}"
    sleep 3
  else
    echo -e "${red}*********************************************************************************************************${endColor}"
    echo -e "${red}**************************CLAMAV IS ALREADY INSTALLED, PROCEEDING TO UNINSTALL***************************${endColor}"
    echo -e "${red}*********************************************************************************************************${endColor}"
    sleep 3
    sudo yum -y erase clamav*
    echo -e "${green}*********************************************************************************************************${endColor}"
    echo -e "${green}*************************************PROCEEDING TO INSTALL***********************************************${endColor}"
    echo -e "${green}*********************************************************************************************************${endColor}"
    sleep 3
    sudo yum -y install clamav
    echo -e "${final}*********************************************************************************************************${endColor}"
    echo -e "${final}***************************************SUCCESSFULLY INSTALLED********************************************${endColor}"
    echo -e "${final}*********************************************************************************************************${endColor}"
    sleep 3
  fi
fi

#4. Packages with available updates will be updated 

if [[ $(yum check-update -q | awk '{print $1}') = "" ]];
then
  echo -e "${final}*********************************************************************************************************${endColor}"
  echo -e "${final}************************************NO PACKAGE NEEDS TO UPDATE*******************************************${endColor}" 
  echo -e "${final}*********************************************************************************************************${endColor}"
  sleep 3
else
  echo -e "${green}*********************************************************************************************************${endColor}"
  echo -e "${green}******************************THE PACKAGES WITH UPDATES AVAILABLE ARE THESE******************************${endColor}" 
  echo -e "${green}*********************************************************************************************************${endColor}"
  sudo yum check-update -q | awk '{print $1}'
  sleep 3
  echo -e "${blue}*********************************************************************************************************${endColor}"
  echo -e "${blue}*******************************PACKAGES WILL BE UPDATED**************************************************${endColor}"
  echo -e "${blue}*********************************************************************************************************${endColor}"
  for line in $(yum check-update -q | awk '{print $1}');
  do
    sudo yum -y update $line
    echo -e "${final}***********************************************************************************************************${endColor}"
    echo -e "${final}******************************THE PACKAGE WAS SUCCESSFULLY UPDATED*****************************************${endColor}"
    echo -e "${final}***********************************************************************************************************${endColor}"
done

exit 0
fi
