#!/usr/bin/bash 
#Autor: Eduardo Lopez Solis 1865221

green="\e[0;32m\033[1m"
finalcolo="\033[0m\e[0m"
red="\e[0;31m\033[1m"
blue="\e[0;34m\033[1m"
listado=$(yum list installed | grep '^clamav')
version=$(grep 'VERSION_ID' /etc/os-release)

#1. Script will identify the version of the operating system and EPEL will be installed only on Centos v7 servers 

echo '******************************PROCEEDING TO IDENTIFY THE VERSION OF OS**********************************'
if [[ $version = 'VERSION_ID="8"' ]];
then
  echo -e "${blue}*********************************************************************************************************"
  echo -e "${blue}*************************************YOUR OS IS CentOS v8************************************************"
  echo -e "${blue}*********************************************************************************************************"
  echo -e "${blue}*********************************************************************************************************"
  echo -e "${blue}************************EPEL WILL NOT BE INSTALLED DUE TO THE CENTOS VERSION*****************************"
  echo -e "${blue}*********************************************************************************************************"
  
  #2. Clamav antivirus will be installed or reinstalled if it is already installed 
  
  if [[ $listado = "" ]];
  then
    echo -e "${red}*********************************************************************************************************"
    echo -e "${red}**********************************CLAMAV IS NOT INSTALLED************************************************"
    echo -e "${red}***********************************PROCEEDING TO INSTALL*************************************************"
    echo -e "${red}*********************************************************************************************************"
    sleep 3
    sudo yum -y install https://www.clamav.net/downloads/production/clamav-0.104.1.linux.x86_64.rpm
    echo -e "${green}*********************************************************************************************************"
    echo -e "${green}***************************************SUCCESSFULLY INSTALLED********************************************"
    echo -e "${green}*********************************************************************************************************"
    sleep 3
  else
    echo -e "${blue}*********************************************************************************************************"
    echo -e "${blue}**************************CLAMAV IS ALREADY INSTALLED, PROCEEDING TO UNINSTALL***************************"
    echo -e "${blue}*********************************************************************************************************"
    sleep 3
    sudo yum -y erase clamav*
    echo -e "${blue}*********************************************************************************************************"
    echo -e "${blue}*************************************PROCEEDING TO INSTALL***********************************************"
    echo -e "${blue}*********************************************************************************************************"
    sleep 3
    sudo yum -y install https://www.clamav.net/downloads/production/clamav-0.104.1.linux.x86_64.rpm
    echo -e "${green}*********************************************************************************************************"
    echo -e "${green}***************************************SUCCESSFULLY INSTALLED********************************************"
    echo -e "${green}*********************************************************************************************************"
    sleep 3
  fi
elif [[ $version = 'VERSION_ID="7"' ]];
then
  echo -e "${blue}*********************************************************************************************************"
  echo -e "${blue}*************************************YOUR OS IS CentOS v7************************************************"
  echo -e "${blue}*********************************************************************************************************/n"
  echo -e "${green}*********************************************************************************************************"
  echo -e "${green}****************************CENTOS v7 DETECTED, EPEL WILL BE INSTALLED***********************************"
  echo -e "${green}*********************************************************************************************************"
  sleep 3
  sudo yum -y install https://dl.fedoraproject.org/pub/epel/epel-release-latest-7.noarch.rpm
  sleep 3
  if [[ $listado = "" ]];
  then
    echo -e "${red}*********************************************************************************************************"
    echo -e "${red}**********************************CLAMAV IS NOT INSTALLED************************************************"
    echo -e "${red}***********************************PROCEEDING TO INSTALL*************************************************"
    echo -e "${red}*********************************************************************************************************"
    sleep 3
    sudo yum -y install clamav
    echo -e "${green}*********************************************************************************************************"
    echo -e "${green}***************************************SUCCESSFULLY INSTALLED********************************************"
    echo -e "${green}*********************************************************************************************************"
    sleep 3
  else
    echo -e "${red}*********************************************************************************************************"
    echo -e "${red}**************************CLAMAV IS ALREADY INSTALLED, PROCEEDING TO UNINSTALL***************************"
    echo -e "${red}*********************************************************************************************************"
    sleep 3
    sudo yum -y erase clamav*
    echo -e "${blue}*********************************************************************************************************"
    echo -e "${blue}*************************************PROCEEDING TO INSTALL***********************************************"
    echo -e "${blue}*********************************************************************************************************"
    sleep 3
    sudo yum -y install clamav
    echo -e "${green}*********************************************************************************************************"
    echo -e "${green}***************************************SUCCESSFULLY INSTALLED********************************************"
    echo -e "${green}*********************************************************************************************************"
    sleep 3
  fi
fi

#4. Packages with available updates will be updated 

if [[ $(yum check-update -q | awk '{print $1}') = "" ]];
then
  echo -e "${blue}*******************************************************************************************************"
  echo -e "${blue}**********************************NO PACKAGE NEEDS TO UPDATE*******************************************" 
  echo -e "${blue}*******************************************************************************************************"
  sleep 3
else
  echo -e "${green}*********************************************************************************************************"
  echo -e "${green}******************************THE PACKAGES WITH UPDATES AVAILABLE ARE THESE******************************" 
  echo -e "${green}*********************************************************************************************************"
  sudo yum check-update -q | awk '{print $1}'
  sleep 3
  echo -e "${blue}*********************************************************************************************************"
  echo -e "${blue}*******************************PACKAGES WILL BE UPDATED**************************************************"
  echo -e "${blue}*********************************************************************************************************"
  for line in $(yum check-update -q | awk '{print $1}');
  do
    sudo yum -y update $line
    echo -e "${green}***********************************************************************************************************"
    echo -e "${green}******************************THE PACKAGE WAS SUCCESSFULLY UPDATED*****************************************"
    echo -e "${green}***********************************************************************************************************"
done

exit 0
fi
